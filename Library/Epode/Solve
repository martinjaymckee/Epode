#ifndef EPODE_SOLVE_H
#define EPODE_SOLVE_H

#include "BogackiShampine"
#include "Butcher" // TODO: THE DEFAULT SOLVER SHOULD BECOME RKF45 EVENTUALLY
#include "RKF"
#include "Core"
#include "Integrator"

namespace epode
{

template<typename System, typename State>
auto solve(System system, auto dv, auto v0, auto end, State y0)
{
    using system_properties_t = decltype(internal::stateProperties(system(v0, y0)));
    using state_properties_t = decltype(internal::stateProperties(y0));

    static_assert(
        system_properties_t::N == state_properties_t::N,
        "Initial state, y0, passed into solve is incompatible with the specified system of equations."
    );

    using value_t = typename std::common_type<
        typename system_properties_t::value_t,
        typename state_properties_t::value_t
    >::type;

    //using Solver = Integrator<value_t, system_properties_t::N, method::Butcher5th>;
    /using Solver = Integrator<value_t, system_properties_t::N, method::RKF12>;
    //using Solver = Integrator<value_t, system_properties_t::N, method::RKF23>;
    //using Solver = Integrator<value_t, system_properties_t::N, method::RKF34>;
    //using Solver = Integrator<value_t, system_properties_t::N, method::RKF45>;
    //using Solver = Integrator<value_t, system_properties_t::N, method::BS32>;
    //using Solver = Integrator<value_t, system_properties_t::N, method::BS45>;

    auto solver = Solver(dv, 1e-10);

    return solver(system, v0, end, y0);
}

} /*namespace epode*/

#endif // EPODE_SOLVE_H

