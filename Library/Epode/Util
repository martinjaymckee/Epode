//
//
// File - Epode/Util:
//
//      Functions to simplify the implementation of other Epode features.
//
//
// License:
//
//      This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
//  If a copy of the MPL was not distributed with this file, You can obtain one
//  at http://mozilla.org/MPL/2.0/.
//
//

#ifndef EPODE_UTIL_H
#define EPODE_UTIL_H

#include <fstream>

#include "Core"

namespace epode
{
namespace util
{

template<typename Value>
inline Value lastInitElement(std::initializer_list<Value> _init) {
    auto it = _init.begin();
    Value last = *it;
    for(; it != _init.end(); ++it) {
        last = *it;
    }
    return last;
}

// TODO: CURRENTLY IF THIS FAILS TO OPEN THE FILE FOR SOME REASON, THERE IS NO COMPLAINT, THE FILE
//  SIMPLY GOES UNWRITTEN.  THAT SHOULD, PROBABLY, BE CHANGED.
void resultsToCSV(const char* filename, auto results){
    auto file = std::ofstream{};
    file.open(filename, std::ofstream::out);
    if(file) {
        for(auto result: results) {
            using properties_t = decltype(internal::stateProperties(result.y));
            constexpr size_t N = properties_t::N;

            file << result.dv << ", ";
            file << result.v << ", ";

            for(size_t idx = 0; idx < N; ++idx) {
                file << result.y[idx];
                if(idx < (N-1)) file << ", ";
            }

            file << "\n";
        }

        file.close();
    }
}

} /*namespace util*/
} /*namespace epode*/

#endif // EPODE_UTIL_H

